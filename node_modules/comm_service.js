
////
//// Service.js
////
//// This module is responsible for returning data back to our client's AJAX
//// style calls.  These responses can either be in JSON or XML format.
////

var serviceJSON = require('./comm_service/comm_service_JSON.js');
var serviceXML  = require('./comm_service/comm_service_XML.js');

// sendError (req, res, options)

exports.sendError = function (req, res, options) {

    //// Build our Response Object
    var response = {
        success:'false',
        errorID:'150',  // unknown
        errorMSG:'Unknown. Something went wrong.',
        data:{}
    };
    
    for (var x in options) {
        response[x] = options[x];
    }

    var requestType = req.headers.accept;
    var isJson = req.is('json') || req.is('*/json') || (requestType.indexOf('json') != -1);
    
    if (isJson) {
        
        // JSON Requested
        serviceJSON.send( req, res, response);
    
    } else if (requestType.indexOf('xml') != -1) {

        // XML Requested
        serviceXML.send( req, res, response);
    }

    return response;
}



// sendSuccess( req, res, options)
exports.sendSuccess = function (req, res, data) {

    //// build our response object:
    var response = {
        success:'true',
        data: data
    };

//    for (var x in data) {
//        response.data[x] = data[x];
//    }
    

    var requestType = req.headers.accept;
    if ((requestType.indexOf('json') != -1) || (req.query.format == 'json') || (req.params.format == 'json')) {
    
        // JSON requested: 
        serviceJSON.send( req, res, response);
        
    } else if (requestType.indexOf('xml') != -1) {
    
        // XML requested
        serviceXML.send( req, res, response);
    }

    return response;
}
